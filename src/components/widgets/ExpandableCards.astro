---
import WidgetWrapper from '~/components/ui/WidgetWrapper.astro';
import Headline from '~/components/ui/Headline.astro';
import Image from '~/components/common/Image.astro';

interface Card {
  title: string;
  image: {
    src: string;
    alt: string;
  };
  summary: string;
  content: string;
}

interface Props {
  title?: string;
  subtitle?: string;
  tagline?: string;
  cards?: Card[];
  id?: string;
  isDark?: boolean;
  classes?: Record<string, string>;
  bg?: string;
}

const {
  title = await Astro.slots.render('title'),
  subtitle = await Astro.slots.render('subtitle'),
  tagline = await Astro.slots.render('tagline'),
  cards = [],
  id,
  isDark = false,
  classes = {},
  bg = await Astro.slots.render('bg'),
} = Astro.props;
---

<WidgetWrapper id={id} isDark={isDark} containerClass={`max-w-6xl ${classes?.container ?? ''}`} bg={bg}>
  <Headline title={title} subtitle={subtitle} tagline={tagline} classes={classes?.headline as Record<string, string>} />
  
  <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mt-8">
    {cards.map((card, index) => (
      <div class="expandable-card rounded-lg shadow-lg overflow-hidden bg-white dark:bg-slate-800 transition-all duration-300">
        <div class="relative h-48 overflow-hidden">
          <Image
            src={card.image.src}
            alt={card.image.alt}
            class="w-full h-full object-cover"
            widths={[400, 768]}
            sizes="(max-width: 768px) 100vw, 400px"
            loading="lazy"
          />
        </div>
        
        <div class="p-6">
          <h3 class="text-xl font-bold mb-3 text-gray-900 dark:text-white">
            {card.title}
          </h3>
          
          <p class="text-gray-600 dark:text-gray-300 mb-4">
            {card.summary}
          </p>
          
          <div class="expandable-content max-h-0 overflow-hidden transition-all duration-500 ease-in-out">
            <div class="pt-4 border-t border-gray-200 dark:border-gray-700">
              <div class="prose prose-sm dark:prose-invert max-w-none" set:html={card.content} />
            </div>
          </div>
          
          <button
            class="expand-btn mt-4 flex items-center gap-2 text-primary hover:text-secondary transition-colors duration-200 font-semibold"
            aria-expanded="false"
            aria-controls={`card-content-${index}`}
          >
            <span class="expand-text">Citește mai mult</span>
            <svg class="expand-icon w-5 h-5 transition-transform duration-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
            </svg>
          </button>
        </div>
      </div>
    ))}
  </div>
</WidgetWrapper>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const cards = document.querySelectorAll('.expandable-card');
    
    cards.forEach((card) => {
      const button = card.querySelector('.expand-btn');
      const content = card.querySelector('.expandable-content');
      const icon = card.querySelector('.expand-icon');
      const text = card.querySelector('.expand-text');
      
      if (!button || !content || !icon || !text) return;
      
      button.addEventListener('click', () => {
        const isExpanded = button.getAttribute('aria-expanded') === 'true';
        
        if (isExpanded) {
          // Collapse
          content.style.maxHeight = '0';
          button.setAttribute('aria-expanded', 'false');
          icon.style.transform = 'rotate(0deg)';
          text.textContent = 'Citește mai mult';
        } else {
          // Expand
          content.style.maxHeight = content.scrollHeight + 'px';
          button.setAttribute('aria-expanded', 'true');
          icon.style.transform = 'rotate(180deg)';
          text.textContent = 'Citește mai puțin';
        }
      });
    });
  });
</script>

<style>
  .expandable-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 12px 40px rgba(0, 0, 0, 0.15);
  }
  
  .prose :global(h4) {
    font-size: 1.125rem;
    font-weight: 700;
    margin-top: 1rem;
    margin-bottom: 0.5rem;
  }
  
  .prose :global(p) {
    margin-bottom: 0.75rem;
  }
  
  .prose :global(ul),
  .prose :global(ol) {
    margin-bottom: 1rem;
    padding-left: 1.5rem;
  }
  
  .prose :global(li) {
    margin-bottom: 0.25rem;
  }
</style>
